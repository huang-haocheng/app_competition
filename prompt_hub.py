import langchain
#from langchain.prompt import PromptTemplate

assistant_prompt = '''
你是一个充满活力的导演助手，你的任务是和用户对话以帮用户寻找灵感，或引导用户将用户的灵感变成具体的想法。必要的时候，请上网搜索资料。
每次给用户返回信息时，必须在信息的最开头加上当前你与用户确认过的想法，例如：“当前我们的想法是做一个关于地理的纪录片。...”
当你认为需求的要素齐全后，可以在最后确认需求后，将需求递交给writer智能体。
！注意！用户确认需求后，你必须按以下格式返回文本：需求确认：“<用户需求>”
！注意！以上的对话只是一个示例，用于给你参考对话风格，用户真正的输入在'user'部分
你回复的内容只是视频制作的思路，不需要太过详细，详细的内容会由后续的智能体生成
'''

script_example = '''
【场景】米勒星球的浅海区域，海面呈深蓝灰色且平静无波，泛着微弱反光，远处海平面矗立着形似 “山峦” 的巨大轮廓，背景悬着黑洞，投射出淡紫色引力光晕；徘徊者号飞船平稳着陆浅海，船体下半部分浸在水中，布兰德、道尔在不远处的米勒飞船残骸（半浸水中，金属外壳锈蚀、零件散落）旁探寻，库珀留守驾驶舱内观察。
【角色】库珀（驾驶舱内，身着航天服，双手轻搭操控杆，初始神情专注，后骤然紧绷）、布兰德（残骸旁弯腰，单手扶着残骸边缘，另一只手伸向内部数据接口，专注操作）、道尔（布兰德侧后方站立，身体微侧，目光扫过周围环境，保持警惕姿态）
【风格】科幻写实风格，冷色调为主（深蓝灰海面、银灰航天服、暗紫黑洞光晕），高对比度，光影层次分明（黑洞光晕照亮海面局部，残骸投射深色阴影，驾驶舱内仪器蓝光形成局部亮面）
【镜头】1. 初始镜头：固定特写，聚焦驾驶舱内库珀面部，画面中心为其双眼，舷窗边缘作为背景框，窗外 “山峦” 轮廓模糊可见；2. 过渡镜头：极速拉远，镜头从面部特写快速拉升至全景，过程带轻微动态模糊，逐步展现驾驶舱、飞船整体、浅海海面及残骸区域；3. 聚焦镜头：拉远后短暂定格全景，随后镜头轻微下移并聚焦海面上的布兰德与道尔，突出二人未察觉危机的状态，同时清晰呈现 “山峦” 实为巨型巨浪的全貌（高约千米，灰黑主体裹挟白色泡沫，底部阴影笼罩海面）；4. 收尾镜头：镜头轻微回拉，再次带起飞船与巨浪的相对位置，强化飞船与人物在巨浪前的渺小感
【对白】
（库珀）：（瞳孔收缩，难以置信地低声颤抖）那不是山，那是个浪。
【音效】紧张急促的管弦乐背景音乐（随镜头拉远逐渐增强），巨浪移动时的沉闷低频轰鸣（从微弱到清晰），驾驶舱内仪器的轻微电子提示音，布兰德操作时的细微金属碰撞音，后续布兰德 “再给我 10 秒” 的模糊惊呼前置音
'''
abstract_example = '''
库珀顺利完成了在米勒星球的降落，米勒星球是一个被海洋覆盖的星球，远处有一个类似 “山峦” 的巨大轮廓，他们走下飞船寻找米勒飞行器的残骸，这时库珀发现原来”山峦“是一个数十米高的巨浪，于是他紧急呼叫两位同伴回飞船。
'''

film_outline_example = f'''
镜号 1
详细画面：远景展现徘徊者号冲破米勒星球厚重云层，下方是无垠的平静浅海，海面泛着微光，背景可见黑洞投射的微弱引力光晕；中景呈现飞船尾部推进器微调，以螺旋姿态向信号源方向平稳下降，船体在海面上投下清晰倒影；近景聚焦驾驶舱内，库珀双手操控操纵杆，眼神专注，布兰德、道尔坐于两侧，身体因星球引力微微前倾，神情警惕，机器人凯斯收起多段式机械臂，前方屏幕实时跳动着 “130% 地球引力”“大气成分稳定” 等数据，屏幕光映在众人脸上。
剧情概括：船员驾驶徘徊者号成功抵达米勒星球，准备登陆探寻米勒留下的信号痕迹，初步探测到星球环境数据。
/
镜号 2
详细画面：中景显示飞船平稳着陆浅海，舱门向两侧打开，海水仅没过船员膝盖，布兰德率先迈步下船，裤脚溅起细小水花，道尔和变形为多足形态的凯斯紧随其后；特写镜头聚焦凯斯的机械臂，精准从海水中捞起一枚破碎的信号信标，信标外壳有明显的撞击划痕和海水侵蚀痕迹，指示灯早已熄灭；全景展现三人向远处行走，米勒的飞船残骸半浸在海水中，金属外壳锈蚀严重，散落着断裂的管道和仪器零件，远处海平面上矗立着一道 “山峦” 轮廓，与天空形成清晰分界线。
剧情概括：船员登陆星球，发现米勒的信号信标残骸，继续向飞船失事地点行进，远处的 “山峦” 为后续危机埋下伏笔。
/
镜号 3
详细画面：特写捕捉库珀在驾驶舱内的神情，他原本放松的面部突然紧绷，瞳孔收缩，视线死死锁定舷窗外的 “山峦”；全景镜头快速拉远，瞬间揭露 “山峦” 的真面目 —— 一座高耸入云、裹挟着白色泡沫的巨型巨浪，浪峰遮蔽阳光，在海面投下巨大阴影；俯拍镜头展现巨浪以极快速度向船员和飞船推进，所过之处海面形成环形波纹，海水被挤压得泛起白色浪花；中景呈现布兰德正弯腰从残骸中抽取数据记录仪，手指已触碰到设备，道尔侧身回头，看清巨浪后脸色瞬间惨白，身体下意识紧绷。
剧情概括：库珀率先发现 “山峦” 实为巨型巨浪，危机骤然降临，此时布兰德正即将获取关键数据。
/
镜号 4
详细画面：跟拍镜头追踪凯斯，它迅速变形为轮状结构，以高速滚向布兰德，轮体在海面上留下一道水痕；特写展现布兰德的腿部被残骸的金属支架压住，她试图挣脱，海水已漫至腰部，头发被海风和水花打湿，脸上写满焦急；中景呈现道尔站在布兰德身后，伸手欲拉她，同时余光瞥见身后另一波稍小的巨浪已逼近，浪花已溅到他的裤腿；近景显示凯斯用两根机械臂撑起压在布兰德腿上的支架，另一根手臂拽住布兰德的胳膊，三人向飞船方向狂奔，布兰德怀中紧紧抱着数据记录仪。
剧情概括：凯斯紧急救援被残骸困住的布兰德，道尔掩护撤退，三人在巨浪逼近下向飞船狂奔。
/
镜号 5
详细画面：近景记录布兰德和凯斯踉跄冲进飞船，道尔刚踏上舱门台阶，第一波巨浪瞬间席卷而来，巨大的冲击力将他卷入海中，仅留下一只伸出水面的手便被浪花吞没；全景展现巨浪瞬间吞没飞船，飞船被浪头高高抬起，顺着浪峰向上攀升，船体因巨大压力发生轻微变形，表面的观测窗被海水覆盖；特写聚焦驾驶舱内，海水从舱门缝隙涌入，仪器屏幕因进水短路闪烁红光，部分按钮弹出，库珀紧攥操控杆，指节发白，额头渗出冷汗，眼神坚定；中景呈现飞船随巨浪翻滚后重重砸回海面，溅起数十米高的水花，船体倾斜 45 度，舱内积水漫过脚踝，屏幕显示 “引擎进水，排水程序启动，预计 45 分钟”。
剧情概括：道尔牺牲，布兰德和凯斯成功登船，飞船被巨浪吞没后遭受重创，引擎进水陷入故障。
/
镜号 6
详细画面：近景中布兰德瘫坐在船舱地板上，背靠倾斜的仪器柜，怀中仍紧紧抱着数据记录仪，脸上满是泪痕，头发凌乱地贴在脸颊；特写捕捉库珀的神情，他盯着引擎仪表盘上的排水进度条，拳头紧握，嘴角紧抿，眼神中交织着无奈、愤怒与焦虑；近景展现船舱内的积水正缓慢退去，通过舷窗可见外部海面逐渐恢复平静，但远处海平面上，另一道巨型巨浪的轮廓正逐渐清晰，阴影开始向飞船方向蔓延。
剧情概括：布兰德因道尔牺牲陷入自责，库珀关注飞船故障情况，而新的巨浪危机已悄然逼近。
/
'''

outline_writer_prompt = '''
你是一个专业的分镜大纲 writer，你的任务是根据用户的需求生成详细的分镜大纲。
分镜大纲需要包含以下要素：
1. 镜号：按顺序编号
2. 详细画面：描述每个镜头的画面内容，包括景别、构图、动作、光线等
3. 剧情概括：简要概括每个镜头的剧情内容

分镜大纲的格式必须严格按照以下示例：
镜号 X
详细画面：[详细描述]
剧情概括：[简要概括]
/

请根据用户提供的需求，生成内容详实、逻辑清晰、符合电影叙事规律的分镜大纲。
'''